function wlmsIsNumberKey(e){var r=e.which?e.which:event.keyCode;return r>31&&(48>r||r>57)?!1:!0}function is_member_type_issues_exists(e,r){for(var t=[],l=0;l<e.length;l++)if(e[l].member_role==r){t.push({id:e[l].id,books_borrow:e[l].books_borrow,fine:e[l].fine,member_role:e[l].member_role,returned_days:e[l].returned_days});break}return t}function addDays(e,r){return new Date(e.getTime()+24*r*60*60*1e3)}function delete_item_from_list(){jQuery(".wlms_list_delete").length>0&&jQuery(".wlms_list_delete").click(function(e){e.preventDefault(),jQuery("#wlms_deleted_str").val(jQuery(this).data("id")+","+jQuery(this).data("name")),jQuery("#wlms_selected_button").length>0&&jQuery("#wlms_selected_button").val("delete"),jQuery(".wlms_delete_popup_header").html("Delete Confirmation"),jQuery(".wlms_delete_popup_content").html("Are you sure to delete this information ?"),jQuery(".wlms-delete-btn").html("Delete"),jQuery(".wlms_cancel").html("Cancel"),jQuery(".wlms_overlay").fadeIn(),jQuery(".wlms_delete_popup_main").fadeIn()})}jQuery(document).ready(function(){function e(e){jQuery(".tabs .content.visible").removeClass("visible"),jQuery(".tabs .content:nth-of-type("+(e+1)+")").addClass("visible"),jQuery(".tabs nav a.selected").removeClass("selected"),jQuery(".tabs nav a:nth-of-type("+(e+1)+")").addClass("selected")}if(jQuery(".wlmsTablesorter").length>0&&jQuery(".wlmsTablesorter").on("processing.dt",function(e,r,t){delete_item_from_list()}).dataTable(),jQuery.validator.addMethod("valueNotEquals",function(e,r,t){return t!=e},""),jQuery("#book_categories_form").validate({rules:{wlms_book_categories_name:"required"},messages:{wlms_book_categories_name:"*"},submitHandler:function(e){e.submit()}}),jQuery("#books_form").validate({rules:{wlms_book_title:"required",wlms_category:{valueNotEquals:"-1"},wlms_book_author:"required",wlms_book_edition:"required",wlms_store_type:{valueNotEquals:"-1"},wlms_book_price:"required",wlms_book_location:"required",wlms_book_copies:"required",wlms_Isbn:"required",wlms_book_pdf_copy_url:"required",wlms_pdf_link:"required"},messages:{wlms_book_title:"*",wlms_category:{valueNotEquals:"*"},wlms_book_author:"*",wlms_book_edition:"*",wlms_store_type:{valueNotEquals:"*"},wlms_book_price:"*",wlms_book_location:"*",wlms_book_copies:"*",wlms_Isbn:"*",wlms_book_pdf_copy_url:"*",wlms_pdf_link:"*"},submitHandler:function(e){e.submit()}}),jQuery("#bulk_book_form").validate({rules:{booksFileToUpload:{valueNotEquals:""}},messages:{booksFileToUpload:{valueNotEquals:"*"}},submitHandler:function(e){e.submit()}}),jQuery("#borrow_form").validate({rules:{wlms_select_member_type:{valueNotEquals:"-1"},wlms_due_date:"required"},messages:{wlms_select_member_type:{valueNotEquals:"*"},wlms_due_date:"*"},submitHandler:function(e){e.submit()}}),jQuery("#message_form").validate({rules:{wlms_message_receiver:{valueNotEquals:""},wlms_msg_subject:"required"},messages:{wlms_message_receiver:{valueNotEquals:"*"},wlms_msg_subject:"*"},submitHandler:function(e){e.submit()}}),jQuery("#member_issues_form").validate({rules:{member_roles:{valueNotEquals:"-1"},allow_returned_days:"required",allow_books_borrow:"required",fine_per_day:"required"},messages:{member_roles:{valueNotEquals:"*"},allow_returned_days:"*",allow_books_borrow:"*",fine_per_day:"*"},submitHandler:function(e){e.submit()}}),jQuery(".wlms_delete_popup_close_icon").length>0&&jQuery(".wlms_cancel").length>0&&jQuery(".wlms_delete_popup_close_icon, .wlms_cancel").click(function(){jQuery(".wlms_delete_popup_main").fadeOut(),jQuery(".wlms_overlay").fadeOut()}),delete_item_from_list(),jQuery(".wlms-delete-btn").length>0&&jQuery(".wlms-delete-btn, .approved, .rejected").click(function(e){jQuery(".wlms_loader_delete_panel").css("display","inline-block"),"delete"==jQuery("#wlms_selected_button").val()&&jQuery.ajax({type:"POST",url:ajax_object.ajaxurl,data:{action:"wlms_delete_from_list_by_selected_id",sParms:jQuery("#wlms_deleted_str").val(),security:ajax_object.ajax_nonce},success:function(e){e&&"deleted"==e&&(jQuery(".wlms_loader_delete_panel").css("display","none"),jQuery(".wlms_overlay").fadeOut(),jQuery(".wlms_delete_popup_main").fadeOut(),window.location.href=window.location.href)}}),"accepted"==jQuery("#wlms_selected_button").val()&&jQuery.ajax({type:"POST",url:ajax_object.ajaxurl,data:{action:"wlms_accepted_requested_books_by_selected_id",sParms:jQuery("#wlms_deleted_str").val(),member:jQuery("#wlms_member").val(),security:ajax_object.ajax_nonce},success:function(e){e&&""!=e&&(alert(e),jQuery(".wlms_loader_delete_panel").css("display","none"),jQuery(".wlms_overlay").fadeOut(),jQuery(".wlms_delete_popup_main").fadeOut(),window.location.href=window.location.href)}}),"rejected"==jQuery("#wlms_selected_button").val()&&jQuery.ajax({type:"POST",url:ajax_object.ajaxurl,data:{action:"wlms_rejected_requested_books_by_selected_id",sParms:jQuery("#wlms_deleted_str").val(),security:ajax_object.ajax_nonce},success:function(e){e&&""!=e&&(alert(e),jQuery(".wlms_loader_delete_panel").css("display","none"),jQuery(".wlms_overlay").fadeOut(),jQuery(".wlms_delete_popup_main").fadeOut(),window.location.href=window.location.href)}})}),(jQuery("#wlms_book_edition_year").length>0||jQuery("#wlms_copyright_year").length>0)&&jQuery("#wlms_book_edition_year, #wlms_copyright_year").datepicker({dateFormat:"yy",showOn:"both",changeMonth:!1,changeYear:!0,yearRange:"1960:2030",constrainInput:!0,showButtonPanel:!0,onClose:function(e,r){jQuery(this).datepicker("setDate",new Date(r.selectedYear,1))}}),jQuery("#wlms_borrow_start_date").length>0&&jQuery("#wlms_borrow_end_date").length>0&&jQuery("#wlms_borrow_start_date, #wlms_borrow_end_date").datepicker({dateFormat:"yy-mm-dd",showOn:"both",changeMonth:!0,changeYear:!0,yearRange:"1960:2030",constrainInput:!0}),jQuery("#wlms_borrow_return_start_date").length>0&&jQuery("#wlms_borrow_return_end_date").length>0&&jQuery("#wlms_borrow_return_start_date, #wlms_borrow_return_end_date").datepicker({dateFormat:"yy-mm-dd",showOn:"both",changeMonth:!0,changeYear:!0,yearRange:"1960:2030",constrainInput:!0}),jQuery("#wlms_borrow_due_start_date").length>0&&jQuery("#wlms_borrow_due_end_date").length>0&&jQuery("#wlms_borrow_due_start_date, #wlms_borrow_due_end_date").datepicker({dateFormat:"yy-mm-dd",showOn:"both",changeMonth:!0,changeYear:!0,yearRange:"1960:2030",constrainInput:!0}),jQuery(".add_selected_book").change(function(){if(-1!=jQuery("#wlms_select_member_type").val()){var e;if(jQuery("#wlms_issues_data").val()&&""!=jQuery("#wlms_issues_data").val()){e=JSON.parse(jQuery("#wlms_issues_data").val());var r=is_member_type_issues_exists(e,jQuery("#wlms_select_member_type").val());r.length>0?jQuery(".add_selected_book:checked").length==r[0].books_borrow?(jQuery(".add_selected_book").attr("disabled","disabled"),alert(r[0].books_borrow+" books are allowed for this member type"),jQuery(".add_selected_book:checked").removeAttr("disabled")):jQuery(".add_selected_book").removeAttr("disabled"):(alert('How many book(s) will be allow for this member type, please configure from "Member Issues Settings"'),jQuery(this).prop("checked",!1),jQuery("#wlms_select_member_type").val("-1"))}else alert('How many book(s) will be allow for this member type, please configure from "Member Issues Settings"'),jQuery(this).prop("checked",!1),jQuery("#wlms_select_member_type").val("-1")}else alert("Please select member type first"),jQuery(this).prop("checked",!1)}),jQuery(".wlms_is_return").length>0&&jQuery(".wlms_is_return").click(function(){jQuery(".wlms_overlay").fadeIn("slow"),jQuery(".wlms_delete_popup_main").fadeIn("slow"),jQuery("#wlms_return_id").val(jQuery(this).attr("id")),jQuery("#wlms_borrow_id").val(jQuery(this).data("borrow_id")),jQuery("#wlms_book_id").val(jQuery(this).data("book_id"))}),jQuery(".wlms-return-btn").length>0&&jQuery(".wlms-return-btn").click(function(){jQuery(".wlms_loader_delete_panel").css("display","inline-block"),jQuery.ajax({type:"POST",url:ajax_object.ajaxurl,data:{action:"wlms_return_by_selected_id",sParms_id:jQuery("#wlms_return_id").val(),sParms_borrow_id:jQuery("#wlms_borrow_id").val(),sParms_book_id:jQuery("#wlms_book_id").val(),security:ajax_object.ajax_nonce},success:function(e){e&&"updated"==e&&(jQuery(".wlms_loader_delete_panel").css("display","none"),jQuery(".wlms_overlay").fadeOut(),jQuery(".wlms_delete_popup_main").fadeOut(),window.location.href=window.location.href)}})}),jQuery("#wlms_member_type_for_message").length>0&&jQuery("#wlms_member_type_for_message").change(function(){jQuery.ajax({type:"POST",url:ajax_object.ajaxurl,data:{action:"wlms_get_option_by_member_type",sParms_id:jQuery("#"+jQuery(this).attr("id")).val(),security:ajax_object.ajax_nonce},success:function(e){e&&""!=e?jQuery("#wlms_message_receiver").html(e):jQuery("#wlms_message_receiver").html("")}})}),jQuery("#wlms_select_member_type").length>0&&jQuery("#wlms_select_member_type").change(function(){var e;if(jQuery("#wlms_issues_data").val()&&""!=jQuery("#wlms_issues_data").val()){e=JSON.parse(jQuery("#wlms_issues_data").val());var r=is_member_type_issues_exists(e,jQuery(this).val());if(r.length>0){var t=new Date,l=r[0].returned_days,a=addDays(t,l),s=a.getDate(),_=a.getMonth()+1,o=a.getFullYear(),u=o+"-"+_+"-"+s;jQuery("#wlms_due_date").val(u)}else jQuery("#wlms_due_date").val("")}jQuery(".add_selected_book").prop("checked",!1),jQuery.ajax({type:"POST",url:ajax_object.ajaxurl,data:{action:"wlms_get_option_by_member_type_for_borrower",sParms_id:jQuery("#"+jQuery(this).attr("id")).val(),security:ajax_object.ajax_nonce},success:function(e){var r="";if(e&&""!=e){for(var t=JSON.parse(e),l=0;l<t.length;l++)r+='<option value="'+t[l].user_id+'">'+t[l].display_name+"</option>";jQuery("#wlms_select_member").text(""),jQuery("#wlms_select_member").append(r)}else jQuery("#wlms_select_member").text("")}})}),jQuery("#wlms_logo_uploader").length>0){var r;jQuery("#wlms_logo_uploader").click(function(){r=wp.media.frames.file_frame=wp.media({title:"Choose Logo Image",button:{text:"Add Logo Image"},multiple:!1}),r.on("select",function(){var e=r.state().get("selection").first().toJSON();e.url&&jQuery("#wlms_logo_url").val(e.url)}),r.open()})}if(jQuery("#wlms_cover_image_uploader").length>0){var r;jQuery("#wlms_cover_image_uploader").click(function(){r=wp.media.frames.file_frame=wp.media({title:"Choose Cover Image",button:{text:"Add Cover Image"},multiple:!1}),r.on("select",function(){var e=r.state().get("selection").first().toJSON();!e.url||"image/png"!=e.mime&&"image/jpeg"!=e.mime&&"image/jpg"!=e.mime?alert("Please Upload PNG, JPEG or JPG Images"):jQuery("#wlms_cover_image_url").val(e.url)}),r.open()})}if(jQuery("#wlms_pdf_copy_uploader").length>0){var r;jQuery("#wlms_pdf_copy_uploader").click(function(){r=wp.media.frames.file_frame=wp.media({title:"Choose Pdf File",button:{text:"Add Pdf File"},multiple:!1}),r.on("select",function(){var e=r.state().get("selection").first().toJSON();e.url&&"application/pdf"==e.mime?jQuery("#wlms_book_pdf_copy_url").val(e.url):alert("Please Upload Only Pdf File")}),r.open()})}if(jQuery("#wlms_borrow_filter").length>0&&jQuery("#wlms_borrow_filter").click(function(){jQuery.ajax({type:"POST",url:ajax_object.ajaxurl,data:{action:"wlms_get_borrow_filter_data_by_date",sParms_start_date:jQuery("#wlms_borrow_start_date").val(),sParms_end_date:jQuery("#wlms_borrow_end_date").val(),security:ajax_object.ajax_nonce},success:function(e){e&&""!=e&&(jQuery(".wlms_filter_borrow_list").html(""),jQuery(".wlms_filter_borrow_list").html(e),jQuery(".wlmsTablesorter").trigger("update"))}})}),jQuery("#wlms_borrow_return_filter").length>0&&jQuery("#wlms_borrow_return_filter").click(function(){jQuery.ajax({type:"POST",url:ajax_object.ajaxurl,data:{action:"wlms_get_borrow_return_filter_data_by_date",sParms_start_date:jQuery("#wlms_borrow_return_start_date").val(),sParms_end_date:jQuery("#wlms_borrow_return_end_date").val(),security:ajax_object.ajax_nonce},success:function(e){e&&""!=e&&(jQuery(".wlms_filter_borrow_return_list").html(""),jQuery(".wlms_filter_borrow_return_list").html(e),jQuery(".wlmsTablesorter").trigger("update"))}})}),jQuery("#wlms_borrow_due_filter").length>0&&jQuery("#wlms_borrow_due_filter").click(function(){jQuery.ajax({type:"POST",url:ajax_object.ajaxurl,data:{action:"wlms_get_borrow_due_filter_data_by_date",sParms_start_date:jQuery("#wlms_borrow_due_start_date").val(),sParms_end_date:jQuery("#wlms_borrow_due_end_date").val(),security:ajax_object.ajax_nonce},success:function(e){e&&""!=e&&(jQuery(".wlms_filter_borrow_due_list").html(""),jQuery(".wlms_filter_borrow_due_list").html(e),jQuery(".wlmsTablesorter").trigger("update"))}})}),jQuery("#wlms_store_type").length>0&&jQuery("#wlms_store_type").change(function(){"soft"==jQuery(this).val()?jQuery(".pdf-copy, .pdf-online-copy").show():jQuery(".pdf-copy, .pdf-online-copy").hide()}),jQuery(".wlms-member-dashboard-content").length>0&&(jQuery(".tabs nav a").on("click",function(){e(jQuery(this).index())}),e(0)),jQuery(".accepted-requested").length>0&&jQuery(".accepted-requested").click(function(){jQuery("#wlms_deleted_str").val(jQuery(this).data("id")),jQuery("#wlms_selected_button").length>0&&jQuery("#wlms_selected_button").val("accepted"),jQuery("#wlms_member").length>0&&jQuery("#wlms_member").val(jQuery(this).data("member")),jQuery(".wlms_delete_popup_header").html("Approved Confirmation"),jQuery(".wlms_delete_popup_content").html("Are you sure to approved this book for borrow ?"),jQuery(".wlms-delete-btn").html("Approved"),jQuery(".wlms_cancel").html("Cancel"),jQuery(".wlms_overlay").fadeIn(),jQuery(".wlms_delete_popup_main").fadeIn()}),jQuery(".rejected-requested").length>0&&jQuery(".rejected-requested").click(function(){jQuery("#wlms_deleted_str").val(jQuery(this).data("id")),jQuery("#wlms_selected_button").length>0&&jQuery("#wlms_selected_button").val("rejected"),jQuery("#wlms_member").length>0&&jQuery("#wlms_member").val(jQuery(this).data("member")),jQuery(".wlms_delete_popup_header").html("Rejected Confirmation"),jQuery(".wlms_delete_popup_content").html("Are you sure to rejected this request ?"),jQuery(".wlms-delete-btn").html("Rejected"),jQuery(".wlms_cancel").html("Cancel"),jQuery(".wlms_overlay").fadeIn(),jQuery(".wlms_delete_popup_main").fadeIn()}),jQuery("#books_issued_chart").length>0){var t="",l=[],a=["#3c8dbc","#F39C12","#f56954"];if(jQuery("#reports_json_data").val()&&(t=JSON.parse(jQuery("#reports_json_data").val())),t.length>0)for(var s=0;s<t.length;s++)a[s]&&l.push(a[s]);if(l.length>0){for(var _=[],o=0;o<t.length;o++){var u={};u.label=t[o].name,u.value=t[o].total,_.push(u)}new Morris.Donut({element:"books_issued_chart",resize:!0,colors:l,data:_,hideHover:"auto"})}}});